<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.1/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.1/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.1/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection@0.0/face_detection.js" crossorigin="anonymous"></script>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400&display=swap" rel="stylesheet">

    <style>
        .camera-view {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }
        .canvas-block {
            margin-top: 10px;
        }
        select, button {
            margin: 10px;
            padding: 10px;
        }
    </style>
</head>

<body>
    <!-- 攝影機選擇 -->
    <div class="column column-input_video">
        <h3>選擇攝影機</h3>
        <select id="cameraSelect"></select> <!-- 用於選擇攝影機的下拉菜單 -->
        <button id="startCamera">開始預覽</button> <!-- 開始攝影機預覽 -->
        <button id="goToPage" disabled>進入拍照頁面</button> <!-- 跳轉到拍照頁面的按鈕 -->
    </div>

    <!-- 攝影機預覽區 -->
    <div class="column-canvas camera-view">
        <video id="video1" width="480" height="480" autoplay></video> <!-- 攝影機預覽 -->
    </div>
</body>

<script>
  let selectedCameraId;
  const videoElement = document.getElementById('video1');
  const cameraSelect = document.getElementById('cameraSelect');
  const goToPageButton = document.getElementById('goToPage');

  // 獲取可用攝影機並填充到下拉菜單
  navigator.mediaDevices.enumerateDevices()
    .then(devices => {
      const videoDevices = devices.filter(device => device.kind === 'videoinput');
      videoDevices.forEach((device, index) => {
        const option = document.createElement('option');
        option.value = device.deviceId;
        option.text = device.label || `攝影機 ${index + 1}`;
        cameraSelect.appendChild(option);
      });
    })
    .catch(error => console.error('無法獲取攝影機:', error));

  // 當按下「開始預覽」按鈕時，顯示所選攝影機的畫面
  document.getElementById('startCamera').addEventListener('click', () => {
    selectedCameraId = cameraSelect.value;
    if (selectedCameraId) {
      navigator.mediaDevices.getUserMedia({
        video: { deviceId: selectedCameraId }
      })
      .then(stream => {
        videoElement.srcObject = stream;
        goToPageButton.disabled = false; // 啟用跳轉按鈕
      })
      .catch(error => console.error('無法啟動攝影機:', error));
    }
  });

  // 當按下「進入拍照頁面」按鈕時，跳轉到指定的頁面並傳遞選擇的攝影機 ID
  goToPageButton.addEventListener('click', () => {
    if (selectedCameraId) {
      window.location.href = `https://ivan17lai.github.io/IDphotoCam-TY/?id=${selectedCameraId}`;
    }
  });
</script>
</html>
